[TOC]

# MapReduce

## 1. Scaling-out in superior to Scaling-up

- `scale-out` : 아주 많은 값싼 서버들을 이용함
- `scale-up` : 적은 수의 값비싼 서버들을 이용함
- 데이터 중심 어플리케이션 분야에서는 아주 많은 값싼 서버들을 많이 이용하는 것을 선호한다.
- 고가의 서버들은 가격의 관점에서는 선형으로 성능이 증가하지 않는다.
  - 두 배 성능의 프로세서 한 개를 가진 컴퓨터 가격이 일반적이 프로세서 한 개를 가진 컴퓨터 가격의 두 배보다 훨씬 비싸다.

<br>

## 2. MapReduce

- 데이터 중심 프로세싱
  - 한 대의 컴퓨터의 능력으로 처리가 어렵다.
  - 근본적으로 수 십대, 수 백대 혹은 수 천대의 컴퓨터를 묶어서 처리해야 한다.
  - 맵리듀스 프레임워크가 하는 것이 바로 이것이다.
- 맵리듀스는 빅데이터를 이용한 효율적인 계산이 가능한 첫 번째 프로그래밍 모델
  - 기존에 존재하는 여러가지 다른 병렬 컴퓨팅 방법에서는 프로그래머가 낮은 레벨의 시스템 세부 내용까지 아주 잘 알고 많은 시간을 쏟아야만 한다.
- 빅데이터를 이용하는 응용분야에서 최근에 주목 받고 있다.
- 값싼 컴퓨터들을 모아서 클러스터를 만들고 여기에서 빅데이터를 처리하기 위한 스케일러블(scalable) 병렬 소프트웨어의 구현을 쉽게 할 수 있도록 도와주는 간단한 프로그래밍 모델
  - `scalable` : 사용자 수가 급증하거나 데이터가 급증해도 프로그램이 멈추거나 성능이 크게 떨어지는 일이 없음
- 구글의 맵리듀스 또는 오픈소스인 하둡은 맵리듀스 프레임워크의 우수한 구현의 형태이다.
- 드라이버에 해당하는 메인 함수가 맵(map) 함수와 리듀스(reduce) 함수를 호출해서 처리한다.

<br>

## 3. MapReduce 프로그래밍 모델

- 함수형 프로그래밍 언어의 형태
- 유저는 아래 3가지 함수를 구현해서 제공해야 한다.
  - Main 함수
  - Map 함수
  - Reduce 함수

<br>

## 4. MapReduce Phase

- 맵리듀스 프레임워크에서는 각각의 레코드 또는 튜플은 key-value 쌍으로 표현된다.
- 메인 함수를 한 개의 마스터 머신에서 수행하는데, 이 머신은 맵 함수를 수행하기 전에 전처리를 하거나 리듀스 함수의 결과를 후처리 하는데 사용될 수 있다.
- 컴퓨팅은 맵과 리듀스라는 유저가 정의한 함수 한 쌍으로 이루어진 맵리듀스 페이즈를 한 번 수행하거나 여러 번 반복해서 수행할 수 있다.
- 한번의 맵리듀스 페이즈는 맵 함수를 먼저 호출하고 그 다음에 리듀스 함수를 호출하는데 때에 따라서는 맵 함수가 끝난 후에 컴바인 함수를 중간에 수행할 수 있다.
- 드라이버에 해당하는 메인 프로그램에서 맵리듀스 페이즈를 수행시킨다.

### 1) Map Phase

- 제일 먼저 수행되며 데이터의 여러 파티션에 병렬 분산으로 호출되어 수행된다.
- 각 머신마다 수행된 Mapper는 맵 함수가 입력 데이터의 한 줄마다 맵 함수를 호출한다.
- 맵 함수는 (key, value) 쌍 형태로 결과를 출력하고 여러 머신에 나누어 보내며 같은 키를 가진 (key, value) 쌍은 같은 머신으로 보내진다.

### 2) Shuffling Phase

- 모든 머신에서 맵 페이즈가 다 끝나면 시작된다.
- 맵 페이즈에서 각각의 머신으로 보내진 (key, value) 쌍을 key를 이용해서 정렬한 후에 각각의 key마다 같은 key를 가진 (key, value) 쌍을 모아서 value list를 만든 다음에 (key, value-list) 형태로 key에 따라서 여러 머신에 분산해서 보낸다.

### 3) Reduce Phase

- 모든 머신에서 셔플링 페이즈가 다 끝나면 각 머신마다 리듀스 페이즈가 시작된다.
- 각각의 머신에서는 셔플링 페이즈에서 해당 머신으로 보낸진 각각의 (key, value-list) 쌍 마다 리듀스 함수가 호출되며 하나의 리듀스 함수가 끝나면 다음 (key, value-list) 쌍에 리듀스 함수가 호출된다.
- 출력이 있다면 (key, value) 쌍 형태로 출력한다.

<br>

## 5. MapReduce의 함수

### 1) Map

- Mapper 클래스를 상속받아서 맵 메서드를 수정한다.
- 입력 텍스트 파일에서 라인 단위로 호출되고 입력은 (key, value-list)의 형태
- key는 입력 텍스트 파일에서 맨 앞 문자를 기준으로 맵 함수가 호출된 해당 라인의 첫 번째 문자까지의 오프셋
- value는 텍스트의 해당 라인 전체가 들어있다.

### 2) Reduce

- Reducer 클래스를 상속받아서 리듀스 메서드를 수정한다.
- 셔플링 페이즈의 출력을 입력으로 받는데 (key, value-list)의 형태
- value-list는 맵 함수의 출력에서 key를 갖는 (key, value) 쌍들의 value들의 리스트

### 3) Combine

- 리듀스 함수와 유사한 함수인데 각 머신에서 맵 페이즈에서 맵 함수의 출력 크기를 줄여서 셔플링 페이즈와 리듀스 페이즈의 비용을 줄여주는데 사용된다.